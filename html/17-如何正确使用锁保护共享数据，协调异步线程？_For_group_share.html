<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>17-å¦‚ä½•æ­£ç¡®ä½¿ç”¨é”ä¿æŠ¤å…±äº«æ•°æ®ï¼Œåè°ƒå¼‚æ­¥çº¿ç¨‹ï¼Ÿ</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>17-å¦‚ä½•æ­£ç¡®ä½¿ç”¨é”ä¿æŠ¤å…±äº«æ•°æ®ï¼Œåè°ƒå¼‚æ­¥çº¿ç¨‹ï¼Ÿ</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æç¥ã€‚</p><p>åœ¨å‰å‡ å¤©çš„åŠ é¤æ–‡ç« ä¸­æˆ‘è®²åˆ°ï¼ŒJMQä¸ºäº†æå‡æ•´ä¸ªæµç¨‹çš„å¤„ç†æ€§èƒ½ï¼Œä½¿ç”¨äº†ä¸€ä¸ªâ€œè¿‘ä¹æ— é”â€çš„è®¾è®¡ï¼Œè¿™é‡Œé¢å…¶å®éšå«ç€ä¸¤ä¸ªä¿¡æ¯ç‚¹ã€‚ç¬¬ä¸€ä¸ªæ˜¯ï¼Œåœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œâ€œé”â€æ˜¯ä¸€ä¸ªå¿…é¡»è¦ä½¿ç”¨çš„æŠ€æœ¯ã€‚ç¬¬äºŒä¸ªæ˜¯ï¼Œä½¿ç”¨é”å…¶å®ä¼šé™ä½ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•æ­£ç¡®ä½¿ç”¨é”ï¼Œåˆéœ€è¦æ³¨æ„å“ªäº›äº‹é¡¹å‘¢ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥èŠä¸€èŠè¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨å¼‚æ­¥å’Œå¹¶å‘çš„è®¾è®¡å¯ä»¥å¤§å¹…æå‡ç¨‹åºçš„æ€§èƒ½ï¼Œä½†æˆ‘ä»¬ä¸ºæ­¤ä»˜å‡ºçš„ä»£ä»·æ˜¯ï¼Œç¨‹åºæ¯”åŸæ¥æ›´åŠ å¤æ‚äº†ï¼Œå¤šçº¿ç¨‹åœ¨å¹¶è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼Œå¸¦æ¥äº†å¾ˆå¤šä¸ç¡®å®šæ€§ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›éœ€è¦å¤šä¸ªçº¿ç¨‹å¹¶å‘è¯»å†™çš„å…±äº«æ•°æ®ï¼Œå¦‚æœå¤„ç†ä¸å¥½ï¼Œå¾ˆå¯èƒ½ä¼šäº§å‡ºä¸å¯é¢„æœŸçš„ç»“æœï¼Œè¿™è‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ï¼Œå¤§å®¶åº”è¯¥éƒ½å‚ä¸è¿‡å¾®ä¿¡ç¾¤æŠ•ç¥¨å§ï¼Ÿæ¯”å¦‚ï¼Œç¾¤ä¸»è¯´ï¼šâ€œä»Šæ™šå„¿å’±ä»¬èšé¤ï¼Œèƒ½æ¥çš„éƒ½å›æ¶ˆæ¯æŠ¥ä¸€ä¸‹åï¼Œé¡ºä¾¿ç»Ÿè®¡ä¸€ä¸‹äººæ•°ã€‚éƒ½æŒ‰æˆ‘è¿™ä¸ªæ ¼å¼æ¥æŠ¥åã€‚â€ç„¶åï¼Œç¾¤ä¸»å‘äº†ä¸€æ¡æ¶ˆæ¯ï¼šâ€œç¾¤ä¸»ï¼Œ1äººâ€ã€‚</p><p>è¿™æ—¶å€™å°å…­å’Œæ— åŒéƒ½è¦æŠ¥åï¼Œè¿‡ä¸€ä¼šå„¿ï¼Œä»–ä¿©å‡ ä¹åŒæ—¶å„å‘äº†ä¸€æ¡æ¶ˆæ¯ï¼Œâ€œå°å…­ï¼Œ2äººâ€â€œæ— åŒï¼Œ2äººâ€ï¼Œæ¯ä¸ªäººå‘çš„æ¶ˆæ¯éƒ½åªç»Ÿè®¡äº†ç¾¤ä¸»å’Œä»–ä»¬è‡ªå·±ï¼Œä¸€å…±2äººï¼Œè€Œè¿™æ—¶å€™ï¼Œå…¶å®å·²ç»æœ‰3ä¸ªäººæŠ¥åäº†ï¼Œå¹¶ä¸”ï¼Œåœ¨æœ€åå‘æ¶ˆæ¯çš„æ— åŒçš„åå•ä¸­ï¼Œå°å…­çš„æŠ¥åè¢«è¦†ç›–äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/87/e7/87ac82860fe52434dee843c8e710b2e7.jpg" alt=""></p><p>è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„ç”±äºå¹¶å‘è¯»å†™å¯¼è‡´çš„æ•°æ®é”™è¯¯ã€‚ä½¿ç”¨é”å¯ä»¥éå¸¸æœ‰æ•ˆåœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é”çš„åŸç†æ˜¯è¿™æ ·çš„ï¼š<strong>ä»»ä½•æ—¶é—´éƒ½åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œåªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½è®¿é—®è¢«é”ä¿æŠ¤çš„èµ„æºã€‚</strong></p><!-- [[[read_end]]] --><p>åœ¨ä¸Šé¢å¾®ä¿¡ç¾¤æŠ¥åçš„ä¾‹å­ä¸­ï¼Œå¦‚æœè¯´æˆ‘ä»¬çš„å¾®ä¿¡ç¾¤ä¸­æœ‰ä¸€æŠŠé”ï¼Œæƒ³è¦æŠ¥åçš„äººå¿…é¡»å…ˆæ‹¿åˆ°é”ï¼Œç„¶åæ‰èƒ½æ›´æ–°æŠ¥ååå•ã€‚è¿™æ ·ï¼Œå°±é¿å…äº†å¤šä¸ªäººåŒæ—¶æ›´æ–°æ¶ˆæ¯ï¼ŒæŠ¥ååå•ä¹Ÿå°±ä¸ä¼šå‡ºé”™äº†ã€‚</p><h2>é¿å…æ»¥ç”¨é”</h2><p>é‚£æ˜¯ä¸æ˜¯é‡åˆ°è¿™ç§æƒ…å†µéƒ½è¦ç”¨é”è§£å†³å‘¢ï¼Ÿæˆ‘åˆ†äº«ä¸€ä¸‹æˆ‘ä¸ªäººä½¿ç”¨é”çš„ç¬¬ä¸€æ¡åŸåˆ™ï¼š<strong>å¦‚æœèƒ½ä¸ç”¨é”ï¼Œå°±ä¸ç”¨é”ï¼›å¦‚æœä½ ä¸ç¡®å®šæ˜¯ä¸æ˜¯åº”è¯¥ç”¨é”ï¼Œé‚£ä¹Ÿä¸è¦ç”¨é”ã€‚</strong>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºï¼Œè™½ç„¶è¯´ä½¿ç”¨é”å¯ä»¥ä¿æŠ¤å…±äº«èµ„æºï¼Œä½†æ˜¯ä»£ä»·è¿˜æ˜¯ä¸å°çš„ã€‚</p><p>ç¬¬ä¸€ï¼ŒåŠ é”å’Œè§£é”è¿‡ç¨‹éƒ½æ˜¯éœ€è¦CPUæ—¶é—´çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ€§èƒ½çš„æŸå¤±ã€‚å¦å¤–ï¼Œä½¿ç”¨é”å°±æœ‰å¯èƒ½å¯¼è‡´çº¿ç¨‹ç­‰å¾…é”ï¼Œç­‰å¾…é”è¿‡ç¨‹ä¸­çº¿ç¨‹æ˜¯é˜»å¡çš„çŠ¶æ€ï¼Œè¿‡å¤šçš„é”ç­‰å¾…ä¼šæ˜¾è‘—é™ä½ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>ç¬¬äºŒï¼Œå¦‚æœå¯¹é”ä½¿ç”¨ä¸å½“ï¼Œå¾ˆå®¹æ˜“é€ æˆæ­»é”ï¼Œå¯¼è‡´æ•´ä¸ªç¨‹åºâ€œå¡æ­»â€ï¼Œè¿™æ˜¯éå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚æœ¬æ¥å¤šçº¿ç¨‹çš„ç¨‹åºå°±éå¸¸éš¾äºè°ƒè¯•ï¼Œå¦‚æœå†åŠ ä¸Šé”ï¼Œå‡ºç°å¹¶å‘é—®é¢˜æˆ–è€…æ­»é”é—®é¢˜ï¼Œä½ çš„ç¨‹åºå°†æ›´åŠ éš¾è°ƒè¯•ã€‚</p><p>æ‰€ä»¥ï¼Œä½ åœ¨ä½¿ç”¨é”ä»¥å‰ï¼Œä¸€å®šè¦éå¸¸æ¸…æ¥šæ˜ç¡®åœ°çŸ¥é“ï¼Œè¿™ä¸ªé—®é¢˜å¿…é¡»è¦ç”¨ä¸€æŠŠé”æ¥è§£å†³ã€‚åˆ‡å¿Œçœ‹åˆ°ä¸€ä¸ªå…±äº«æ•°æ®ï¼Œä¹Ÿæä¸æ¸…å®ƒåœ¨å¹¶å‘ç¯å¢ƒä¸­ä¼šä¸ä¼šå‡ºç°äº‰ç”¨é—®é¢˜ï¼Œå°±â€œä¸ºäº†ä¿é™©ï¼Œç»™å®ƒåŠ ä¸ªé”å§ã€‚â€<strong>åƒä¸‡ä¸èƒ½æœ‰è¿™ç§ä¸è´Ÿè´£ä»»çš„æƒ³æ³•ï¼Œå¦åˆ™ä½ å°†ä¼šä»˜å‡ºæƒ¨ç—›çš„ä»£ä»·ï¼</strong>æˆ‘æ›¾ç»é‡åˆ°è¿‡çš„ä¸¥é‡çº¿ä¸Šäº‹æ•…ï¼Œå…¶ä¸­æœ‰å‡ æ¬¡å°±æ˜¯ç”±äºä¸å½“åœ°ä½¿ç”¨é”å¯¼è‡´çš„ã€‚</p><p><strong>åªæœ‰åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå…±äº«èµ„æºä¸æ”¯æŒå¹¶å‘è®¿é—®ï¼Œæˆ–è€…è¯´å¹¶å‘è®¿é—®å…±äº«èµ„æºä¼šå¯¼è‡´ç³»ç»Ÿé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæ‰éœ€è¦ä½¿ç”¨é”ã€‚</strong></p><h2>é”çš„ç”¨æ³•</h2><p>é”çš„ç”¨æ³•ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>åœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰ï¼Œå…ˆè·å–é”ã€‚</li>
<li>å¦‚æœè·å–é”æˆåŠŸï¼Œå°±å¯ä»¥è®¿é—®å…±äº«èµ„æºäº†ã€‚</li>
<li>æœ€åï¼Œéœ€è¦é‡Šæ”¾é”ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹ç»§ç»­è®¿é—®å…±äº«èµ„æºã€‚</li>
</ol><p>åœ¨Javaè¯­è¨€ä¸­ï¼Œä½¿ç”¨é”çš„ä¾‹å­ï¼š</p><pre><code>private Lock lock = new ReentrantLock();

public void visitShareResWithLock() {
  lock.lock();
  try {
    // åœ¨è¿™é‡Œå®‰å…¨çš„è®¿é—®å…±äº«èµ„æº
  } finally {
    lock.unlock();
  }
}
</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—ï¼Œå®ƒçš„æ•ˆæœå’Œé”æ˜¯ä¸€æ ·çš„ï¼š</p><pre><code>private Object lock = new Object();

public void visitShareResWithLock() {
  synchronized (lock) {
    // åœ¨è¿™é‡Œå®‰å…¨çš„è®¿é—®å…±äº«èµ„æº
  }
}
</code></pre><p>ä½¿ç”¨é”çš„æ—¶å€™ï¼Œä½ éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜ï¼š</p><p>ç¬¬ä¸€ä¸ªï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„é—®é¢˜å°±æ˜¯ï¼Œ<strong>ä½¿ç”¨å®Œé”ï¼Œä¸€å®šè¦é‡Šæ”¾å®ƒ</strong>ã€‚æ¯”è¾ƒå®¹æ˜“å‡ºç°çŠ¶å†µçš„åœ°æ–¹æ˜¯ï¼Œå¾ˆå¤šè¯­è¨€éƒ½æœ‰å¼‚å¸¸æœºåˆ¶ï¼Œå½“æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œä¸å†æ‰§è¡Œåé¢çš„ä»£ç ã€‚å¦‚æœåœ¨è®¿é—®å…±äº«èµ„æºæ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£åé¢é‡Šæ”¾é”çš„ä»£ç å°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™æ ·ï¼Œé”å°±ä¸€ç›´æ— æ³•é‡Šæ”¾ï¼Œå½¢æˆæ­»é”ã€‚æ‰€ä»¥ï¼Œä½ è¦è€ƒè™‘åˆ°ä»£ç å¯èƒ½èµ°åˆ°çš„æ‰€æœ‰æ­£å¸¸å’Œå¼‚å¸¸çš„åˆ†æ”¯ï¼Œç¡®ä¿æ‰€æœ‰æƒ…å†µä¸‹ï¼Œé”éƒ½èƒ½è¢«é‡Šæ”¾ã€‚</p><p>æœ‰äº›è¯­è¨€æä¾›äº†try-withçš„æœºåˆ¶ï¼Œä¸éœ€è¦æ˜¾å¼åœ°è·å–å’Œé‡Šæ”¾é”ï¼Œå¯ä»¥ç®€åŒ–ç¼–ç¨‹ï¼Œæœ‰æ•ˆé¿å…è¿™ç§é—®é¢˜ï¼Œæ¨èä½ ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚åœ¨Pythonä¸­ï¼š</p><pre><code>lock = threading.RLock()

def visitShareResWithLock():
  with lock:
    # æ³¨æ„ç¼©è¿›
    # åœ¨è¿™é‡Œå®‰å…¨çš„è®¿é—®å…±äº«èµ„æº
  
  # é”ä¼šåœ¨withä»£ç æ®µæ‰§è¡Œå®Œæˆåè‡ªåŠ¨é‡Šæ”¾
</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯´ä¸€ä¸‹ï¼Œä½¿ç”¨é”çš„æ—¶å€™ï¼Œé‡åˆ°çš„æœ€å¸¸è§çš„é—®é¢˜ï¼šæ­»é”ã€‚</p><h2>å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</h2><p>æ­»é”æ˜¯æŒ‡ï¼Œç”±äºæŸç§åŸå› ï¼Œé”ä¸€ç›´æ²¡æœ‰é‡Šæ”¾ï¼Œåç»­éœ€è¦è·å–é”çš„çº¿ç¨‹éƒ½å°†å¤„äºç­‰å¾…é”çš„çŠ¶æ€ï¼Œè¿™æ ·ç¨‹åºå°±å¡æ­»äº†ã€‚</p><p>å¯¼è‡´æ­»é”çš„åŸå› å¹¶ä¸å¤šï¼Œç¬¬ä¸€ç§åŸå› å°±æ˜¯æˆ‘åœ¨åˆšåˆšè®²çš„ï¼Œè·å–äº†é”ä¹‹åæ²¡æœ‰é‡Šæ”¾ï¼Œæœ‰ç»éªŒçš„ç¨‹åºå‘˜å¾ˆå°‘ä¼šçŠ¯è¿™ç§é”™è¯¯ï¼Œå³ä½¿å‡ºç°è¿™ç§é”™è¯¯ï¼Œä¹Ÿå¾ˆå®¹æ˜“é€šè¿‡æŸ¥çœ‹ä»£ç æ‰¾åˆ°Bugã€‚</p><p>è¿˜æœ‰ä¸€ç§æ˜¯é”çš„é‡å…¥é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code>public void visitShareResWithLock() {
  lock.lock(); // è·å–é”
  try {
    lock.lock(); // å†æ¬¡è·å–é”ï¼Œä¼šå¯¼è‡´æ­»é”å—ï¼Ÿ
  } finally {
    lock.unlock();
  }
</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå½“å‰çš„çº¿ç¨‹è·å–åˆ°äº†é”lockï¼Œç„¶ååœ¨æŒæœ‰è¿™æŠŠé”çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡å»å°è¯•è·å–è¿™æŠŠé”ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ­»é”å—ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œä¸ä¸€å®šã€‚<strong>ä¼šä¸ä¼šæ­»é”å–å†³äºï¼Œä½ è·å–çš„è¿™æŠŠé”å®ƒæ˜¯ä¸æ˜¯å¯é‡å…¥é”ã€‚</strong>å¦‚æœæ˜¯å¯é‡å…¥é”ï¼Œé‚£å°±æ²¡æœ‰é—®é¢˜ï¼Œå¦åˆ™å°±ä¼šæ­»é”ã€‚</p><p>å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½æä¾›äº†å¯é‡å…¥é”ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„è¦æ±‚ï¼Œä½ è¦å°½é‡ä½¿ç”¨å¯é‡å…¥é”ã€‚æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œâ€œæ—¢ç„¶å·²ç»è·å–åˆ°é”äº†ï¼Œæˆ‘å¹²å˜›è¿˜è¦å†æ¬¡è·å–åŒä¸€æŠŠé”å‘¢ï¼Ÿâ€</p><p>å…¶å®ï¼Œå¦‚æœä½ çš„ç¨‹åºè¶³å¤Ÿå¤æ‚ï¼Œè°ƒç”¨æ ˆå¾ˆæ·±ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œå½“ä½ éœ€è¦è·å–ä¸€æŠŠé”çš„æ—¶å€™ï¼Œä½ æ˜¯ä¸å¤ªå¥½åˆ¤æ–­åœ¨nå±‚è°ƒç”¨ä¹‹å¤–çš„æŸä¸ªåœ°æ–¹ï¼Œæ˜¯ä¸æ˜¯å·²ç»è·å–è¿‡è¿™æŠŠé”äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè·å–å¯é‡å…¥é”å°±æœ‰æ„ä¹‰äº†ã€‚</p><p>æœ€åä¸€ç§æ­»é”çš„æƒ…å†µæ˜¯æœ€å¤æ‚çš„ï¼Œä¹Ÿæ˜¯æœ€éš¾è§£å†³çš„ã€‚å¦‚æœä½ çš„ç¨‹åºä¸­å­˜åœ¨å¤šæŠŠé”ï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™äº›é”äº’ç›¸é”ä½çš„æƒ…å†µã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹é¢è¿™æ®µPythonä»£ç ï¼š</p><pre><code>import threading

def func1(lockA, lockB):
  while True:
    print(&quot;Thread1: Try to accquire lockA...&quot;)
    with lockA:
      print(&quot;Thread1: lockA accquired. Try to accquire lockB...&quot;)
      with lockB:
        print(&quot;Thread1: Both lockA and LockB accrquired.&quot;)


def func2(lockA, lockB):
  while True:
    print(&quot;Thread2: Try to accquire lockB...&quot;)
    with lockB:
      print(&quot;Thread2: lockB accquired. Try to accquire lockA...&quot;)
      with lockA:
        print(&quot;Thread2: Both lockA and LockB accrquired.&quot;)


if __name__ == '__main__':
  lockA = threading.RLock();
  lockB = threading.RLock()
  t1 = threading.Thread(target=func1, args=(lockA, lockB,))
  t2 = threading.Thread(target=func2, args=(lockA, lockB,))
  t1.start()
  t2.start()
</code></pre><p>è¿™ä¸ªä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªæœ€ç®€å•æœ€å…¸å‹çš„æ­»é”æƒ…å†µã€‚åœ¨è¿™ä¸ªç¨‹åºé‡Œé¢ï¼Œæˆ‘ä»¬æœ‰ä¸¤æŠŠé”ï¼šlockAå’ŒlockBï¼Œç„¶åæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹åå¤åœ°å»è·å–è¿™ä¸¤æŠŠé”ï¼Œç„¶åé‡Šæ”¾ã€‚æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹è¿™æ®µä»£ç ï¼Œçœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼š</p><pre><code>$ python3 DeadLock.py
Thread1: Try to accquire lockA...
Thread1: lockA accquired. Try to accquire lockB...
Thread1: Both lockA and LockB accrquired.
Thread1: Try to accquire lockA...
... ...
Thread1: Try to accquire lockA...
Thread2: Try to accquire lockB...
Thread1: lockA accquired. Try to accquire lockB...
Thread2: lockB accquired. Try to accquire lockA...
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºæ‰§è¡Œä¸€ä¼šå„¿å°±å¡ä½äº†ï¼Œå‘ç”Ÿäº†æ­»é”ã€‚é‚£æ­»é”çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¯·æ³¨æ„çœ‹ä»£ç ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ï¼Œä»–ä»¬è·å–é”çš„é¡ºåºæ˜¯ä¸ä¸€æ ·çš„ã€‚ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œå…ˆè·å–lockAï¼Œå†è·å–lockBï¼Œè€Œç¬¬äºŒä¸ªçº¿ç¨‹æ­£å¥½ç›¸åï¼Œå…ˆè·å–lockBï¼Œå†è·å–lockAã€‚</p><p>ç„¶åï¼Œä½ å†çœ‹ä¸€ä¸‹æ­»é”å‰çš„æœ€åä¸¤è¡Œæ—¥å¿—ï¼Œçº¿ç¨‹1æŒæœ‰äº†lockAï¼Œç°åœ¨å°è¯•è·å–lockBï¼Œè€Œçº¿ç¨‹2æŒæœ‰äº†lockBï¼Œå°è¯•è·å–lockAã€‚ä½ å¯ä»¥æƒ³ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼Œä¸¤ä¸ªçº¿ç¨‹ï¼Œå„æŒæœ‰ä¸€æŠŠé”ï¼Œéƒ½ç­‰ç€å¯¹æ–¹æ‰‹é‡Œçš„å¦å¤–ä¸€æŠŠé”ï¼Œè¿™æ ·å°±åƒµæŒä½äº†ã€‚</p><p>è¿™æ˜¯æœ€ç®€å•çš„ä¸¤æŠŠé”ä¸¤ä¸ªçº¿ç¨‹æ­»é”çš„æƒ…å†µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ†ææ¸…æ¥šï¼Œä½ æƒ³æƒ³å¦‚æœä½ çš„ç¨‹åºä¸­æœ‰åå‡ æŠŠé”ï¼Œå‡ åå¤„åŠ é”è§£é”ï¼Œå‡ ç™¾çš„çº¿ç¨‹ï¼Œå¦‚æœå‡ºç°æ­»é”ä½ è¿˜èƒ½åˆ†ææ¸…æ¥šæ˜¯ä»€ä¹ˆæƒ…å†µå—ï¼Ÿ</p><p>å…³äºé¿å…æ­»é”ï¼Œæˆ‘åœ¨è¿™é‡Œç»™ä½ å‡ ç‚¹å»ºè®®ã€‚</p><ol>
<li>å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œé¿å…æ»¥ç”¨é”ï¼Œç¨‹åºé‡Œç”¨çš„é”å°‘ï¼Œå†™å‡ºæ­»é”Bugçš„å‡ ç‡è‡ªç„¶å°±ä½ã€‚</li>
<li>å¯¹äºåŒä¸€æŠŠé”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»è¦æ”¾åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œè¿™æ ·ä¸€æ¬¡åŠ é”å¯¹åº”ä¸€æ¬¡è§£é”ï¼Œä»£ç æ¸…æ™°ç®€å•ï¼Œä¾¿äºåˆ†æé—®é¢˜ã€‚</li>
<li>å°½é‡é¿å…åœ¨æŒæœ‰ä¸€æŠŠé”çš„æƒ…å†µä¸‹ï¼Œå»è·å–å¦å¤–ä¸€æŠŠé”ï¼Œå°±æ˜¯è¦å°½é‡é¿å…åŒæ—¶æŒæœ‰å¤šæŠŠé”ã€‚</li>
<li>å¦‚æœéœ€è¦æŒæœ‰å¤šæŠŠé”ï¼Œä¸€å®šè¦æ³¨æ„åŠ è§£é”çš„é¡ºåºï¼Œè§£é”çš„é¡ºåºè¦å’ŒåŠ é”é¡ºåºç›¸åã€‚æ¯”å¦‚ï¼Œè·å–ä¸‰æŠŠé”çš„é¡ºåºæ˜¯Aã€Bã€Cï¼Œé‡Šæ”¾é”çš„é¡ºåºå¿…é¡»æ˜¯Cã€Bã€Aã€‚</li>
<li>ç»™ä½ ç¨‹åºä¸­æ‰€æœ‰çš„é”æ’ä¸€ä¸ªé¡ºåºï¼Œåœ¨æ‰€æœ‰éœ€è¦åŠ é”çš„åœ°æ–¹ï¼ŒæŒ‰ç…§åŒæ ·çš„é¡ºåºåŠ è§£é”ã€‚æ¯”å¦‚æˆ‘åˆšåˆšä¸¾çš„é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½æŒ‰ç…§å…ˆè·å–lockAå†è·å–lockBçš„é¡ºåºåŠ é”ï¼Œå°±ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚</li>
</ol><p>æœ€åï¼Œä½ éœ€è¦çŸ¥é“ï¼Œå³ä½¿ä½ å®Œå…¨éµä»æˆ‘è¿™äº›å»ºè®®ï¼Œæˆ‘ä¹Ÿæ— æ³•å®Œå…¨ä¿è¯ä½ å†™å‡ºçš„ç¨‹åºå°±æ²¡æœ‰æ­»é”ï¼Œåªèƒ½è¯´ï¼Œä¼šé™ä½ä¸€äº›çŠ¯é”™è¯¯çš„æ¦‚ç‡ã€‚</p><h2>ä½¿ç”¨è¯»å†™é”è¦å…¼é¡¾æ€§èƒ½å’Œå®‰å…¨æ€§</h2><p>å¯¹äºå…±äº«æ•°æ®æ¥è¯´ï¼Œå¦‚æœè¯´æŸä¸ªæ–¹æ³•åœ¨è®¿é—®å®ƒçš„æ—¶å€™ï¼Œåªæ˜¯å»è¯»å–ï¼Œå¹¶ä¸æ›´æ–°æ•°æ®ï¼Œé‚£æ˜¯ä¸æ˜¯å°±ä¸éœ€è¦åŠ é”å‘¢ï¼Ÿè¿˜æ˜¯éœ€è¦çš„ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªçº¿ç¨‹è¯»æ•°æ®çš„åŒæ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åŒæ—¶åœ¨æ›´æ–°æ•°æ®ï¼Œé‚£ä¹ˆä½ è¯»åˆ°çš„æ•°æ®æœ‰å¯èƒ½æ˜¯æ›´æ–°åˆ°ä¸€åŠçš„æ•°æ®ï¼Œè¿™è‚¯å®šæ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ã€‚æ‰€ä»¥ï¼Œæ— è®ºæ˜¯åªè¯»è®¿é—®ï¼Œè¿˜æ˜¯è¯»å†™è®¿é—®ï¼Œéƒ½æ˜¯éœ€è¦åŠ é”çš„ã€‚</p><p>å¦‚æœç»™æ•°æ®ç®€å•åœ°åŠ ä¸€æŠŠé”ï¼Œè™½ç„¶è§£å†³äº†å®‰å…¨æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯ç‰ºç‰²äº†æ€§èƒ½ï¼Œå› ä¸ºï¼Œé‚£æ— è®ºè¯»è¿˜æ˜¯å†™ï¼Œéƒ½æ— æ³•å¹¶å‘äº†ï¼Œè·Ÿå•çº¿ç¨‹çš„ç¨‹åºæ€§èƒ½æ˜¯ä¸€æ ·ã€‚</p><p>å®é™…ä¸Šï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨æ›´æ–°æ•°æ®ï¼Œé‚£å³ä½¿å¤šä¸ªçº¿ç¨‹éƒ½åœ¨å¹¶å‘è¯»ï¼Œä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æˆ‘åœ¨ä¸ŠèŠ‚è¯¾è·Ÿä½ è®²è¿‡ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ•°æ®çš„è¯»å†™æ¯”æ˜¯ä¸å‡è¡¡çš„ï¼Œè¯»è¦è¿œè¿œå¤šäºå†™ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼š</p><ul>
<li>è¯»è®¿é—®å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</li>
<li>å†™çš„åŒæ—¶ä¸èƒ½å¹¶å‘è¯»ï¼Œä¹Ÿä¸èƒ½å¹¶å‘å†™ã€‚</li>
</ul><p>è¿™æ ·å°±å…¼é¡¾äº†æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚è¯»å†™é”å°±æ˜¯ä¸ºè¿™ä¸€éœ€æ±‚è®¾è®¡çš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Javaä¸­æä¾›çš„è¯»å†™é”ï¼š</p><pre><code>ReadWriteLock rwlock = new ReentrantReadWriteLock();

public void read() {
  rwlock.readLock().lock();
  try {
    // åœ¨è¿™å„¿è¯»å–å…±äº«æ•°æ®
  } finally {
    rwlock.readLock().unlock();
  }
}
public void write() {
  rwlock.writeLock().lock();
  try {
    // åœ¨è¿™å„¿æ›´æ–°å…±äº«æ•°æ®
  } finally {
    rwlock.writeLock().unlock();
  }
}
</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œéœ€è¦è¯»æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬è·å–è¯»é”ï¼Œè·å–åˆ°çš„è¯»é”ä¸æ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯è¯´read()æ–¹æ³•æ˜¯å¯ä»¥å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„ï¼Œè¿™æ ·ä½¿å¾—è¯»æ•°æ®çš„æ€§èƒ½ä¾ç„¶å¾ˆå¥½ã€‚å†™æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬è·å–å†™é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹æ—¢æ— æ³•è·å–è¯»é”ï¼Œä¹Ÿä¸èƒ½è·å–å†™é”ï¼Œè¾¾åˆ°ä¿æŠ¤å…±äº«æ•°æ®çš„ç›®çš„ã€‚</p><p>è¿™æ ·ï¼Œä½¿ç”¨è¯»å†™é”å°±å…¼é¡¾äº†æ€§èƒ½å’Œå®‰å…¨ã€‚</p><h2>å°ç»“</h2><p>é”å¯ä»¥ä¿æŠ¤å…±äº«èµ„æºï¼Œé¿å…å¹¶å‘æ›´æ–°é€ æˆçš„æ•°æ®é”™è¯¯ã€‚åªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½è®¿é—®è¢«ä¿æŠ¤èµ„æºã€‚çº¿ç¨‹åœ¨è®¿é—®èµ„æºä¹‹å‰å¿…é¡»è·å–é”ï¼Œè®¿é—®å®Œæˆåä¸€å®šè¦è®°å¾—é‡Šæ”¾é”ã€‚</p><p>ä¸€å®šä¸è¦æ»¥ç”¨é”ï¼Œå¦åˆ™å®¹æ˜“å¯¼è‡´æ­»é”ã€‚æ­»é”çš„åŸå› ï¼Œä¸»è¦ç”±äºå¤šä¸ªçº¿ç¨‹ä¸­å¤šæŠŠé”ç›¸äº’äº‰ç”¨å¯¼è‡´çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœç¨‹åºä¸­ä½¿ç”¨çš„é”æ¯”è¾ƒå¤šï¼Œå¾ˆéš¾åˆ†ææ­»é”çš„åŸå› ï¼Œæ‰€ä»¥éœ€è¦å°½é‡å°‘çš„ä½¿ç”¨é”ï¼Œå¹¶ä¸”ä¿æŒç¨‹åºçš„ç»“æ„å°½é‡ç®€å•ã€æ¸…æ™°ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä»‹ç»äº†è¯»å†™é”ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨è¯»å†™é”å¯ä»¥å…¼é¡¾æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œæ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘åˆšåˆšè®²åˆ°ï¼ŒPythonä¸­æä¾›äº†try-with-lockï¼Œä¸éœ€è¦æ˜¾å¼åœ°è·å–å’Œé‡Šæ”¾é”ï¼Œéå¸¸æ–¹ä¾¿ã€‚é—æ†¾çš„æ˜¯ï¼Œåœ¨Javaä¸­å¹¶æ²¡æœ‰è¿™æ ·çš„æœºåˆ¶ï¼Œé‚£ä½ èƒ½ä¸èƒ½è‡ªå·±åœ¨Javaä¸­å®ç°ä¸€ä¸ªtry-with-lockå‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä»£ç ä¸Šä¼ åˆ°GitHubä¸Šï¼Œç„¶ååœ¨è¯„è®ºåŒºç»™å‡ºè®¿é—®é“¾æ¥ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ä¸æˆ‘äº¤æµã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/de/23/de0a489e6b4fa9a49450bf9197593423.jpg" alt=""></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            L!en6o  2019-08-31 11:26:15
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            åŠ ä¸€ä¸ªé”å›è°ƒ å°è£…èµ·æ¥ å®ç° try-with-lock<br> [2èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å¼ ä¸‰  2019-08-31 00:15:13
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å¹¸äºå­¦è¿‡æå®¢æ—¶é—´çš„å¹¶å‘ç¼–ç¨‹ä¸“æ ï¼Œçœ‹æ‡‚äº†ã€‚æˆ‘è§‰å¾—å¹¶å‘å®¹å™¨çš„é€‰æ‹©æ¯”è¾ƒå¤æ‚ã€‚ [2èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç³–é†‹ğŸ€  2019-09-01 17:11:49
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            java7å¼€å§‹ioå°±æœ‰try-with-resourceã€‚<br>å¯ä»¥åˆ©ç”¨è¿™ä¸€ä¸ªç‰¹æ€§ï¼Œæ¥è¯´å®ç°ï¼Œè‡ªåŠ¨é‡Šæ”¾ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š<br><br>public class AutoUnlockProxy implements Closeable {<br><br>    private Lock lock;<br><br>    public AutoUnlockProxy(Lock lock) {<br>        this.lock = lock;<br>    }<br><br>    @Override<br>    public void close() throws IOException {<br>        lock.unlock();<br>        System.out.println(&quot;é‡Šæ”¾é”&quot;);<br>    }<br><br>    public void lock() {<br>        lock.lock();<br>    }<br><br>    public void tryLock(long time, TimeUnit unit) throws InterruptedException {<br>        lock.tryLock(time, unit);<br>    }<br><br>    public static void main(String[] args) {<br><br>        try (AutoUnlockProxy autoUnlockProxy = new AutoUnlockProxy(new ReentrantLock())) {<br>            autoUnlockProxy.lock();<br>            System.out.println(&quot;åŠ é”äº†&quot;);<br>        } catch (IOException e) {<br>            e.printStackTrace();<br>        }<br><br>    }<br><br>} [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-09-02 14:06:11</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘ğŸ‘ğŸ‘</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            åˆ˜å¤©é¹  2019-09-02 17:15:20
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å¯¹äºgolangåº”è¯¥å°±æ˜¯è¿™æ ·å§<br>func foo(){<br>  lock.Lock()<br>  defer lock.Unlock()<br>  &#47;&#47;do something...<br>} 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä½ è¯´çš„ç°  2019-09-02 15:54:20
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            <br>public void visitShareResWithLock() {<br>  lock.lock();<br>  try {<br>    &#47;&#47; åœ¨è¿™é‡Œå®‰å…¨çš„è®¿é—®å…±äº«èµ„æº<br>  } finally {<br>    lock.unlock();<br>  }<br>}<br><br> lock.lock(); åŠ é”è¯­å¥æ”¾åœ¨ try catch é‡Œé¢æ˜¯å¦å¯ä»¥ã€‚ä¸ºä»€ä¹ˆå¾ˆå¤šç¤ºä¾‹ä»£ç éƒ½æ”¾åœ¨å¤–é¢ã€‚ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Cast  2019-09-01 22:37:18
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œè¯·é—®ä¸ºä»€ä¹ˆè¦æŒ‰é€†åºå»é‡Šæ”¾é”å‘¢ï¼ŸæŒ‰ç…§è·å–çš„é¡ºåºå»é‡Šæ”¾å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆæ¯›ç—…å§ï¼Ÿ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ¸¸å¼‹äº‘ç«¯  2019-09-01 17:22:25
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ABBAé”æœ€å®¹æ˜“å‡ºé—®é¢˜ï¼Œè€å¸ˆçš„ç»éªŒå¾ˆé‡è¦ï¼Œå°½å¯èƒ½é¿å…é”ä¸­é”ã€‚ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            humor  2019-09-01 15:04:19
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            &#47;**<br>*ä¸šåŠ¡è°ƒç”¨æ¥å£<br>**&#47;<br>public interface Invoker{<br>	void invoke();<br>}<br><br>&#47;**<br>*try-with-lock<br>**&#47;<br>public class RLock{<br>	private Lock lock = new ReentrantLock();<br><br>	public void run(Invoker invoker) {<br>		lock.lock();<br>		try{<br>			invoker.invoke();<br>		} finally{<br>			lock.unlock();<br>		}<br>	}<br>}<br><br>public BizInvoker implements Inoker{<br>	private RLock rLock = new RLock();<br>	public void invoke() {<br>		&#47;&#47;éœ€è¦åŠ é”çš„ä¸šåŠ¡é€»è¾‘<br>	}<br><br>	public static void main(String[] args) {<br>		rLock.run(new BizInvoker());<br>	}<br>} 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            monalisali  2019-08-31 21:32:45
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼šå‡è®¾æœ‰ä¸€ä¸ªæ–¹æ³•åœ¨è®¡ç®—æŠ¥è¡¨ï¼Œä½†è¿™ä¸ªè®¡ç®—çš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«æ„å¤–é‡Šæ”¾äº†ï¼ˆå¹¶ä¸æ˜¯æŠ›å¼‚å¸¸ï¼‰ï¼Œ æ­¤æ—¶try catchæ•è·æ˜¯æ•è·ä¸åˆ°è¿™ç§æƒ…å†µçš„ã€‚è€Œä»å®¢æˆ·ç«¯çœ‹æ¥ï¼Œè¿™ä¸ªè®¡ç®—è¿‡ç¨‹å°±æ°¸è¿œåœåœ¨é‚£é‡Œäº†ï¼Œè€Œåå°åˆæ²¡èƒ½åŠ›å‘Šè¯‰å®¢æˆ·ç«¯ï¼šâ€œä½ åˆ«ç­‰äº†â€ã€‚ è¿™ç§æƒ…å†µåº”è¯¥å¦‚æœå¤„ç†å‘¢ï¼Ÿ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ ‘æ¢¢çš„æœå®  2019-08-31 19:24:48
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            Cè¯­è¨€ä¸‹ï¼Œé€šè¿‡å®å¾ˆå®¹æ˜“å®ç°try-with-lockã€‚<br>å¦‚æœä¸¤ä¸ªçº¿ç¨‹ä¸­è·å–mutexçš„é¡ºåºä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ç¬¬ä¸‰ä¸ªmutexæ¥é¿å…æ­»é”ã€‚<br>æ—¢ç„¶æˆ‘ä»¬åšå¼‚æ­¥ã€å¹¶è¡Œï¼Œç£ç›˜è¯»å†™ä¹Ÿå¯ä»¥è¿™ä¹ˆåšå•Šï¼ŒåŠ ä¸€ä¸ªqueueï¼Œæ‰€æœ‰è¯»å†™æ“ä½œè¯·æ±‚éƒ½æ”¾åˆ°queueä¸­ï¼Œåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å®ŒæˆIOæ“ä½œå¹¶é€šè¿‡callbackæˆ–å¦ä¸€ä¸ªqueueè¿”å›ç»“æœã€‚ä¸çŸ¥æœåŠ¡å™¨ä¸Šè¿™ä¹ˆåšæœ‰ä»€ä¹ˆä¸å¦¥ï¼Ÿ<br> 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-09-02 14:05:49</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">è¿™æ ·åšæ˜¯å¯ä»¥çš„ï¼Œå…¶å®ä½ ç”¨çš„è¿™ä¸ªé˜»å¡é˜Ÿåˆ—å®ƒå°±æ˜¯ç”¨é”æ¥å®ç°çš„ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            è®¸ç«¥ç«¥  2019-08-31 14:05:48
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆè¿™ç¯‡æ–‡ç« çš„åˆ†äº«å¯¹æˆ‘è¿™æ ·çš„éåç«¯ç¨‹åºå‘˜å¾ˆå‹å¥½ï¼Œæ„Ÿè°¢è€å¸ˆçš„åˆ†äº«ã€‚ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ğŸ˜Š  2019-08-31 08:30:15
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            é”æ˜¯ä¸ºäº†å¹¶å‘æ—¶çš„å…±äº«è€Œåˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰å…±äº«çš„çœŸæ­£éœ€æ±‚ä¸åº”è¯¥ä½¿ç”¨é”ã€‚é”å¸¦æ¥çš„æœ€å¤§é—®é¢˜å°±æ˜¯å¤æ‚åº¦å’Œå¿ƒæ™ºè´Ÿæ‹…ä¸Šå‡ï¼Œæ‰€ä»¥å¾ˆå¤šæ¡†æ¶æŠŠæœ€å¤æ‚çš„å®ç°éšè—åœ¨å†…éƒ¨ï¼Œç•™ç»™ä½¿ç”¨è€…ä½¿ç”¨å‡†åˆ™ 
        </div>
        
    </div>
</li>
            </ul>
</div>
</body>
</html>